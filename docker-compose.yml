version: '3.8'

services:
  smtp_bridge:
    # Use the pre-built image from GitHub Container Registry
    # Replace YOUR_USERNAME with your GitHub username
    image: ghcr.io/YOUR_USERNAME/smtp_bridge:latest

    # Or build from source
    # build:
    #   context: .
    #   dockerfile: Dockerfile

    container_name: smtp_bridge

    ports:
      - "8000:8000"

    environment:
      # SMTP Configuration
      - SMTP_HOST=${SMTP_HOST:-smtp.example.com}
      - SMTP_PORT=${SMTP_PORT:-587}
      - SMTP_USERNAME=${SMTP_USERNAME:-}
      - SMTP_PASSWORD=${SMTP_PASSWORD:-}
      - SMTP_USE_TLS=${SMTP_USE_TLS:-true}

      # API Configuration
      - API_KEY=${API_KEY:-}
      - ALLOWED_ORIGINS=${ALLOWED_ORIGINS:-*}

      # Rate Limiting
      - RATE_LIMIT_PER_MINUTE=${RATE_LIMIT_PER_MINUTE:-60}

      # Logging
      - LOG_LEVEL=${LOG_LEVEL:-info}

    # Optionally use .env file instead of environment variables
    # env_file:
    #   - .env

    restart: unless-stopped

    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/api/v1/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 5s

    networks:
      - smtp_bridge_network

networks:
  smtp_bridge_network:
    driver: bridge
